/* style.css — ダーク＋高密度。針半円。余白圧縮。 */
:root{
  --bg:#0b0d12; --fg:#e8eef7; --accent:#2dd4bf; --line:#1f2937;
  --good:#10b981; --mid:#f59e0b; --bad:#ef4444; --muted:#94a3b8;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
  font-family:system-ui,-apple-system,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Roboto,sans-serif}

/* stickyヘッダー（可変高） */
#topbar{
  position:sticky; top:0; z-index:10000;
  display:flex; flex-wrap:wrap; gap:8px 10px; align-items:center; justify-content:space-between;
  padding:6px 10px; background:#0f131a; border-bottom:1px solid var(--line);
}
#topbar .left,#topbar .right{display:flex;flex-wrap:wrap;align-items:center;gap:8px}
#topbar .brand{font-weight:800;margin-right:2px}
#topbar .key-inline,.diff-inline,.rms-inline{display:flex;align-items:center;gap:6px;font-size:12px}
#topbar select{appearance:none;background:#0f1822;color:var(--fg);border:1px solid var(--line);border-radius:10px;padding:8px 10px}
#topbar input[type=number]{width:90px;padding:8px;border-radius:10px;border:1px solid var(--line);background:#0f1822;color:var(--fg)}
#topbar .version{font-size:11px;opacity:.7;margin-left:4px}
#topbar .db{font-size:12px;padding:4px 10px;border-radius:999px;background:#0d1117;border:1px solid var(--line)}
#topbar .a4{font-size:12px;opacity:.85;margin-right:4px}

.seg{display:inline-grid;grid-auto-flow:column;border:1px solid var(--line);border-radius:10px;overflow:hidden}
.seg input{display:none}
.seg label{padding:8px 10px;font-size:12px;cursor:pointer;background:#0f1822;color:#c9d5e3;user-select:none}
.seg input:checked+label{background:#1c2532;color:#fff;font-weight:800}

main{padding:8px 10px 14px;max-width:880px;margin:0 auto}

/* ボタン行（圧縮） */
#controls{max-width:880px;margin:6px auto 8px;padding:0 10px}
#controls .row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
#controls .buttons{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
button{padding:12px;border:0;border-radius:12px;font-weight:800;background:#111827;color:var(--fg);cursor:pointer}
#start{background:#2563eb} #stop{background:#6b7280} #show-errors{background:#374151}
body.running #start{background:#10b981}
#mini-score{font-weight:900}

#hud{display:grid;grid-template-columns:1fr 200px;gap:10px;align-items:start}
@media (max-width:760px){ #hud{grid-template-columns:1fr} }

#score-panel{background:#0f131a;border:1px solid var(--line);border-radius:12px;padding:8px}
#big-score{font-size:30px;font-weight:900;text-align:center}
#advice{text-align:center;margin:2px 0 8px 0;font-size:16px;font-weight:800}
#advice.good{color:#b7ffcf} #advice.warn{color:#ffd89a} #advice.bad{color:#ffb3b3}

/* バー */
#bar-wrap{padding:0 4px}
#cents-scale{display:flex;justify-content:space-between;font-size:10px;color:#9ca3af;margin-bottom:4px}
#cents-bar{position:relative;height:14px;background:linear-gradient(90deg,#20242c 0%,#1d2a33 50%,#20242c 100%);
  border:1px solid var(--line);border-radius:999px;overflow:hidden}
#cents-bar::before{content:"";position:absolute;top:0;bottom:0;width:1px;background:#334155;left:50%}
#bar-needle{position:absolute;top:-3px;width:2px;height:20px;background:var(--accent);left:50%;box-shadow:0 0 8px rgba(45,212,191,.9)}
#bar-left-hint,#bar-right-hint{position:absolute;top:0;height:100%;display:flex;align-items:center;font-size:10px;font-weight:800;opacity:0;transition:opacity .12s ease}
#bar-left-hint{left:6px;color:#87b3ff} #bar-right-hint{right:6px;color:#ff9a9a}
#cents-bar.hint-low #bar-left-hint{opacity:1}  #cents-bar.hint-high #bar-right-hint{opacity:1}
#cents-bar.flash{box-shadow:0 0 0 3px rgba(34,197,94,.25) inset}

/* 針（半円） */
#analog{background:#0f131a;border:1px solid var(--line);border-radius:12px;padding:6px;display:flex;flex-direction:column;align-items:center}
#analog-svg{width:200px;height:100px}
#analog-svg .bezel{stroke:#233043;stroke-width:2}
#analog-svg .hand{stroke:var(--accent);stroke-width:2.2;stroke-linecap:round}
#analog-svg .cap{fill:var(--accent)}
#analog-svg .tick{stroke:#8aa1b8;stroke-width:.8}
#analog-svg .tick.major{stroke-width:1.5}
#analog-svg .label{fill:#9fb6cf;font-size:10px;text-anchor:middle}

#score-area{margin-top:8px}
.score-head{display:flex;align-items:center;justify-content:space-between;margin:2px 0 6px 0}
#staff-wrap{position:relative;width:100%;height:320px;background:#0f131a;border:1px solid var(--line);border-radius:12px;overflow:hidden}
@media (max-width:640px){ #staff-wrap{height:300px} }
#staff{position:absolute;inset:0}
#spark{position:absolute;inset:0;pointer-events:none}

.note-normal{fill:#e8eef7;stroke:#e8eef7}
.note-target{fill:#22c55e;stroke:#22c55e}
.note-failed{fill:#ef4444;stroke:#ef4444}

#prog{font-size:12px;opacity:.9}
#page-label{font-size:11px;color:#9ca3af}

#hud-flash{position:fixed;inset:0;background:rgba(34,197,94,.12);opacity:0;pointer-events:none;transition:opacity .12s ease;z-index:9997}
#hud-flash.show{opacity:1}

#toast{position:fixed;left:0;right:0;bottom:0;padding:8px 10px;font-size:12px;text-align:center;
  background:rgba(40,40,40,.95);color:#fff;transform:translateY(100%);transition:transform .25s ease;z-index:9999}
#toast.show{transform:translateY(0)}
#toast.warn{background:#d97706} #toast.error{background:#b91c1c} #toast.info{background:#374151}
#toast.tiny{font-size:11px;padding:6px 8px}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9998}
.modal.show{display:flex}
.modal .card{width:min(92%,540px); background:#0b1020; border:1px solid #20304a; border-radius:14px; padding:16px; text-align:center; box-shadow:0 10px 40px rgba(0,0,0,.5);}
.modal .label{font-size:13px;opacity:.8;margin-bottom:6px}
#praise{font-size:18px;margin:6px 0}
#details{font-size:12px;opacity:.85;margin-bottom:8px}
.modal .buttons{display:flex;gap:8px}
#again{background:#10b981} #close{background:#374151}
#permit{background:#2563eb}
#error-list{text-align:left;max-height:40vh;overflow:auto;font-size:12px;line-height:1.4}
#err-copy{background:#2563eb} #err-close{background:#6b7280}
